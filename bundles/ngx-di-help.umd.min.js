!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("ngx-popper"),require("@angular/router"),require("rxjs/operators"),require("@angular/common/http"),require("rxjs")):"function"==typeof define&&define.amd?define("ngx-di-help",["exports","@angular/core","@angular/common","ngx-popper","@angular/router","rxjs/operators","@angular/common/http","rxjs"],t):t((e=e||self)["ngx-di-help"]={},e.ng.core,e.ng.common,e.ngxPopper,e.ng.router,e.rxjs.operators,e.ng.common.http,e.rxjs)}(this,function(e,t,r,i,n,o,a,c){"use strict";var l=function(){},s=new t.InjectionToken("DI_HELP_URL"),p=new t.InjectionToken("DI_HELP_CACHE_LIFETIME"),u=function(){function e(e,t,r,i){if(this.http=i,this.cacheById={},this.requestCacheById={},this.cacheByUid={},this.requestCacheByUid={},this.cacheByUrl={},this.requestCacheByUrl={},e){var n=e.resolve();if("string"==typeof n)this.diHelpUrl=c.of(n);else{if(!c.isObservable(n))throw Error("Not supported diHelpUrlResolver");this.diHelpUrl=n}}else{if(!t)throw Error("Please, configure diHelpUrl or diHelpUrlResolver");this.diHelpUrl=c.of(t)}this.cacheLifetime=1e3*r}return e.prototype.getArticleById=function(e){var t=this;return this.diHelpUrl.pipe(o.flatMap(function(r){return t.cachedGet(t.cacheById,t.requestCacheById,e,r+"/api/Articles/GetArticleById/"+e)}))},e.prototype.getArticleByUrl=function(e){var t=this;return this.diHelpUrl.pipe(o.flatMap(function(r){return t.cachedGet(t.cacheByUrl,t.requestCacheByUrl,e,r+"/api/Articles/GetArticleByUrl/?url="+encodeURIComponent(e))}))},e.prototype.getArticleByUid=function(e,t){var r=this;return this.diHelpUrl.pipe(o.flatMap(function(i){return r.cachedGet(r.cacheByUid,r.requestCacheByUid,t,i+"/api/Articles/GetArticleByUid/?siteUrl="+encodeURIComponent(e)+"&uid="+encodeURIComponent(t))}))},e.prototype.getFaqBySiteId=function(e){var t=this;return this.diHelpUrl.pipe(o.flatMap(function(r){return t.http.get(r+"/api/Articles/GetFaqBySiteId/"+e,{headers:{ignoreLoadingBar:""}}).pipe(o.map(function(e){return e}))}))},e.prototype.getFaqBySiteUrl=function(e){var t=this;return this.diHelpUrl.pipe(o.flatMap(function(r){return t.http.get(r+"/api/Articles/GetFaqBySiteUrl/?siteUrl="+encodeURIComponent(e),{headers:{ignoreLoadingBar:""}}).pipe(o.map(function(e){return e}))}))},e.prototype.cachedGet=function(e,t,r,i){var n=this;return e[r]?e[r].error?c.throwError(e[r].error):c.of(e[r].article):t[r]?t[r]:(t[r]=this.http.get(i,{headers:{ignoreLoadingBar:""}}).pipe(o.map(function(e){return e}),o.tap(function(i){delete t[r],e[r]={article:i}}),o.catchError(function(i){return delete t[r],e[r]={error:i},c.throwError(i)}),o.finalize(function(){setTimeout(function(){return delete e[r]},n.cacheLifetime)}),o.share()),t[r])},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:l},{type:String,decorators:[{type:t.Inject,args:[s]}]},{type:Number,decorators:[{type:t.Inject,args:[p]}]},{type:a.HttpClient}]},e}(),h=function(){function e(e,t,r){this.diHelpService=e,this.router=t,this.changeDetector=r,this.alwaysVisible=!0,this.inline=!1}return Object.defineProperty(e.prototype,"articleId",{get:function(){return this._articleId},set:function(e){var t=this;if(this.byLocation)throw Error("Do not use articleId with byLocation");if(this.articleUid)throw Error("Do not use articleId with articleUid");this._articleId!==e&&(this._articleId=e,e&&this.diHelpService.getArticleById(e).subscribe(function(e){t.article=e,t.changeDetector.markForCheck()},function(){t.article=null,t.changeDetector.markForCheck()}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"articleUid",{get:function(){return this._articleUid},set:function(e){var t=this;if(this.byLocation)throw Error("Do not use articleUid with byLocation");if(this.articleId)throw Error("Do not use articleUid with article-id");this._articleUid!==e&&(this._articleUid=e,e&&this.diHelpService.getArticleByUid(location.origin,e).subscribe(function(e){t.article=e,t.changeDetector.markForCheck()},function(){t.article=null,t.changeDetector.markForCheck()}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"byLocation",{get:function(){return this._byLocation},set:function(e){var t=this;if(this.articleId)throw Error("Do not use byLocation with articleId");if(this.articleUid)throw Error("Do not use byLocation with articleUid");this._byLocation!==e&&(this._byLocation=e,e?(this.updateFromLocation(),this.routerEventsSubscription=this.router.events.pipe(o.filter(function(e){return e instanceof n.NavigationEnd})).subscribe(function(){t.updateFromLocation()})):this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe())},enumerable:!0,configurable:!0}),e.prototype.ngOnDestroy=function(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe()},e.prototype.updateFromLocation=function(){var e=this;this.diHelpService.getArticleByUrl(location.origin+location.pathname).subscribe(function(t){e.article=t,e.changeDetector.markForCheck()},function(){e.article=null,e.changeDetector.markForCheck()})},e.decorators=[{type:t.Component,args:[{selector:"di-help",template:'<span class="fa-stack"\n      [ngStyle]="{\'font-size\': inline ? \'0.5em\' : \'10px\'}"\n      [class.invisible]="!(alwaysVisible || article)"\n      [class.disabled]="!article"\n      [popper]="flyOut"\n      [popperDisabled]="!article"\n      [popperTrigger]="\'hover\'"\n      [popperPlacement]="\'top\'"\n      [popperAppendTo]="\'body\'"\n      [popperTimeout]="500"\n      [popperStyles]="{\'min-width\': \'150px\', \'max-width\': \'400px\'}"\n      [popperHideOnMouseLeave]="true"\n      [popperHideOnClickOutside]="true"\n      [popperHideOnScroll]="true"\n      [popperApplyClass]="\'di-help-popper\'">\n    <i class="fa fa-circle fa-stack-2x"></i>\n    <i class="fa fa-question fa-stack-1x"></i>\n</span>\n\n<popper-content #flyOut>\n    <ng-container *ngIf="article">\n        <h4>{{article.Name}}</h4>\n        <span>\n            {{article.ShortText}}\n        </span>\n        <hr class="my-1" *ngIf="article.DiHelpFiles?.length">\n        <a *ngFor="let file of article.DiHelpFiles"\n           class="d-block"\n           target="_blank"\n           href="{{file.Url}}">\n            {{file.Name}}\n        </a>\n        <hr class="my-1" *ngIf="article.Links?.length">\n        <a *ngFor="let link of article.Links"\n           class="d-block"\n           target="_blank"\n           href="{{link.Url}}">\n            {{link.Name}}\n        </a>\n    </ng-container>\n</popper-content>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[":host .fa-stack{cursor:help}:host .fa-stack.disabled{cursor:default;opacity:.6}:host .fa-stack .fa-stack-1x{font-size:1.5em;color:#f2be35}:host .fa-stack .fa-stack-2x{color:#007bff}:host i{vertical-align:middle}::ng-deep .di-help-popper.ngxp__container{background-color:#f9f9f9;z-index:100000000}"]}]}],e.ctorParameters=function(){return[{type:u},{type:n.Router},{type:t.ChangeDetectorRef}]},e.propDecorators={articleId:[{type:t.Input}],articleUid:[{type:t.Input}],byLocation:[{type:t.Input}],alwaysVisible:[{type:t.Input}],inline:[{type:t.Input}]},e}(),d=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[t.diHelpUrlResolver||{provide:l,useValue:null},{provide:s,useValue:t.diHelpUrl},{provide:p,useValue:isNaN(t.cacheLifetimeSecond)?1800:t.cacheLifetimeSecond},u]}},e.decorators=[{type:t.NgModule,args:[{imports:[r.CommonModule,i.NgxPopperModule],declarations:[h],exports:[h]}]}],e}(),f=function(){function e(e){this.diHelpService=e}return Object.defineProperty(e.prototype,"siteId",{get:function(){return this._siteId},set:function(e){var t=this;this._siteId!==e&&(this._siteId=e,e&&this.diHelpService.getFaqBySiteId(e).subscribe(function(e){t.allArticles=e,t.applyFilter()},function(){t.allArticles=null,t.applyFilter()}))},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var e=this;this.siteId||this.diHelpService.getFaqBySiteUrl(location.origin).subscribe(function(t){e.allArticles=t,e.applyFilter()},function(){e.allArticles=null,e.applyFilter()})},e.prototype.applyFilter=function(e){if(void 0===e&&(e=""),e){var t=e.toLowerCase();this.articles=this.allArticles.filter(function(e){return e.Name.toLowerCase().includes(t)||e.ShortText.toLowerCase().includes(t)||e.DiHelpFiles&&e.DiHelpFiles.some(function(e){return e.Name.toLowerCase().includes(t)})||e.Links&&e.Links.some(function(e){return e.Name.toLowerCase().includes(t)})})}else this.articles=this.allArticles},e.decorators=[{type:t.Component,args:[{selector:"di-help-faq",template:'<input type="search"\n       class="form-control"\n       (input)="applyFilter($event.target.value)"\n       name="article-search"\n       placeholder="Search..."\n       autocomplete="off">\n\n<div class="d-block mt-3" *ngFor="let article of articles; let last = last">\n    <h4>{{article.Name}}</h4>\n    <div class="d-block" [innerHtml]="article.ShortText"></div>\n    <div class="mt-3" *ngIf="article.DiHelpFiles">\n        <a class="d-block mt-1" *ngFor="let file of article.DiHelpFiles" [href]="file.Url" target="_blank">{{file.Name}}</a>\n    </div>\n    <div class="mt-3" *ngIf="article.Links">\n        <a class="d-block mt-1" *ngFor="let link of article.Links" [href]="link.Url" target="_blank">{{link.Name}}</a>\n    </div>\n    <hr class="mt-3" *ngIf="!last"/>\n</div>\n'}]}],e.ctorParameters=function(){return[{type:u}]},e.propDecorators={siteId:[{type:t.Input}]},e}(),y=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[r.CommonModule,d],declarations:[f],exports:[f],providers:[u]}]}],e}();e.DI_HELP_CACHE_LIFETIME_TOKEN=p,e.DI_HELP_URL_TOKEN=s,e.DiHelpComponent=h,e.DiHelpFaqComponent=f,e.DiHelpFaqModule=y,e.DiHelpModule=d,e.DiHelpUrlResolver=l,e.ɵa=1800,e.ɵb=u,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-di-help.umd.min.js.map